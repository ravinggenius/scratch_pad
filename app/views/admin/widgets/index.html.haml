%header
  %span.h Listing widgets

%section
  %ul
    - @themes.sort.each do |theme|
      %li
        = link_to theme.name, admin_widgets_path(:theme => theme.machine_name)
        %ul
          - theme.layouts.sort { |a, b| a.name <=> b.name }.each do |layout|
            %li= link_to layout.name.titleize, admin_widgets_path(:theme => theme.machine_name, :layout => layout.name)

  - if @layout
    - theme = Theme[@layout.theme]
    - @widgets.sort!
    = form_tag :action => :update, :theme => theme.machine_name, :layout => @layout.name do |form|
      %fieldset
        %legend= "#{theme.name} - #{@layout.name} layout"
        - @layout.regions.each do |region|
          %fieldset
            %legend= "#{region.name} region"
            %ul
              - region.widgets.each_with_index do |widget, count|
                %li
                  - id = [:regions, region.name, count]
                  = label_tag id.join('_'), "#{(count + 1).ordinalize} widget"
                  %select{ :id => id, :name => "regions[#{region.name}][]" }
                    = options_from_collection_for_select @widgets, :machine_name, :name, :include_blank => true, :selected => widget.machine_name

              - region.widgets.count.upto(@widgets.count - 1) do |count|
                %li
                  - id = [:regions, region.name, count]
                  = label_tag id.join('_'), "#{(count + 1).ordinalize} widget"
                  %select{ :id => id, :name => "regions[#{region.name}][]" }
                    = options_from_collection_for_select @widgets, :machine_name, :name, :include_blank => true
        %ul
          %li= submit_tag 'Commit'
          %li= link_to 'Cancel', admin_widgets_path
